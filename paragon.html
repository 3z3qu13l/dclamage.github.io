<!DOCTYPE html>
<html>
<head>
    <title>Paragon Calculator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/siwalikm/quick-form-css@2.2.2/qfc-dark.css">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="bignumber.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <script src="paragon1.3.js"></script>
    <script>
        "use strict";

        function CalculateParagonSum() {
            var p1 = $("#p1").val();
            var p2 = $("#p2").val();
            var xpsum = BigNumber(GetParagonLevelXP(p1)).plus(BigNumber(GetParagonLevelXP(p2)));
            var psum = GetParagonLevel(xpsum);
            $("#psum").val(psum);
        }

        function CalculateParagon() {
            $("#result").empty();
            var current = $("#current").val();
            var desired = $("#desired").val();
            var xpHr = BigNumber("1000000000").multipliedBy(BigNumber($("#xphr").val()));
            var hrsPerDay = BigNumber($("#hrsperday").val());
            var xpNeeded = DiffParagon(desired, current);
            var hours = xpNeeded.dividedBy(xpHr);
            var days = hours.dividedBy(hrsPerDay);

            var unit = 1;
            while (unit < 1000000000000000 && xpNeeded.isGreaterThan(unit*500)) {
                unit *= 1000;
            }
            if (unit === 1) {
                $("#xpresultlabel").text("XP Needed");
            } else if (unit === 1000) {
                $("#xpresultlabel").text("Thousand XP Needed");
            } else if (unit === 1000000) {
                $("#xpresultlabel").text("Million XP Needed");
            } else if (unit === 1000000000) {
                $("#xpresultlabel").text("Billion XP Needed");
            } else if (unit === 1000000000000) {
                $("#xpresultlabel").text("Trillion XP Needed");
            } else if (unit === 1000000000000000) {
                $("#xpresultlabel").text("Quadrillion XP Needed");
            }
            $("#xpresult").val(xpNeeded.dividedBy(unit).toFixed(3, 4));
            $("#hoursresult").val(hours.toFixed(1, 4));
            $("#daysresult").val(days.toFixed(1, 4));

            UpdateChart(days.toNumber());
        }

        function HaveParagon() {
            $("#p1").bind('input', CalculateParagonSum);
            $("#p2").bind('input', CalculateParagonSum);
            $("#p1").val("1000");
            $("#p2").val("1000");
            CalculateParagonSum();

            $("#current").bind('input', CalculateParagon);
            $("#desired").bind('input', CalculateParagon);
            $("#xphr").bind('input', CalculateParagon);
            $("#hrsperday").bind('input', CalculateParagon);

            $("#current").val("0");
            $("#desired").val("2000");
            $("#xphr").val("2000");
            $("#hrsperday").val("8");
            $("#maindiv").show();
            CalculateParagon();
        }
        var existingChart;
        function UpdateChart(numDays) {
            var days = []
            var level = []
            var curXP = GetParagonLevelXP(parseInt($("#current").val()));
            var xpHr = BigNumber("1000000000").multipliedBy(BigNumber($("#xphr").val()));
            var hrsPerDay = BigNumber($("#hrsperday").val());
            var xpDay = xpHr.multipliedBy(hrsPerDay);
            if (xpDay.isLessThanOrEqualTo(BigNumber("0"))) {
                return;
            }
            numDays = Math.ceil(numDays);
            var increment = Math.max(1, Math.floor(numDays / 30) + 1)
            xpDay = xpDay.multipliedBy(BigNumber(increment))
            for (var i = 0; i <= numDays; i += increment) {
                days.push(i)
                level.push(GetParagonLevel(curXP))
                curXP = curXP.plus(xpDay)
            }

            var ctx = $("#paragonChart");
            if (existingChart) {
                existingChart.destroy()
            }
            existingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Paragon Level',
                        data: level,
                        backgroundColor: 'rgb(255, 99, 132)',
                        borderColor: 'rgb(255, 99, 132)',
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Paragon Level Over Time'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Day'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Paragon Level'
                            }
                        }]
                    }
                }
            });
        }

        $(document).ready(function () {
            LoadParagon(HaveParagon);
        });
    </script>
</head>
<body>
    <div id="maindiv" class="qfc-container" hidden>
        <h3>Add two paragons</h3>
        <table>
            <tr>
                <td><input id="p1" type="text" /></td>
                <td width="100">+</td>
                <td><input id="p2" type="text" /></td>
                <td width="100">=</td="center">
                <td><input id="psum" type="text" readonly /></td>
            </tr>
        </table>

        <h3>How many days to reach goal?</h3>
        <table>
            <tr><td>Current paragon</td><td><input id="current" type="text" /></td></tr>
            <tr><td>Desired paragon</td><td><input id="desired" type="text" /></td></tr>
            <tr><td>Billion XP Per Hour</td><td><input id="xphr" type="text" /></td></tr>
            <tr><td>Hours Per Day</td><td><input id="hrsperday" type="text" /></td></tr>
            <tr><td colspan="2">--- RESULT ---</td></tr>
            <tr><td id="xpresultlabel">Trillion XP Needed</td><td><input id="xpresult" type="text" readonly /></td></tr>
            <tr><td>Hours Needed</td><td><input id="hoursresult" type="text" readonly /></td></tr>
            <tr><td>Days Needed</td><td><input id="daysresult" type="text" readonly /></td></tr>
        </table>

        <canvas id="paragonChart" width="400" height="400"></canvas>
    </div>
</body>
</html>
